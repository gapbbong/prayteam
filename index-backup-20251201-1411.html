<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ™ ê¸°ë„ê·¸ë£¹ ë¡œê·¸ì¸ ë° ê´€ë¦¬</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#101022">
  <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
  <script src="/app-config.js"></script>

  <style>
    body {
      font-family: "Noto Sans KR", sans-serif;
      background: radial-gradient(circle at top, #1c1f3a, #0d0e16);
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      overflow-x: hidden;
    }

    h2 {
      margin-bottom: 10px;
      color: #ffdf6b;
    }

    .container {
      max-width: 400px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.07);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(255, 255, 255, 0.15);
      transition: all 0.5s ease;
      transform-origin: top center;
    }

    /* âœ… ì ‘íˆëŠ” ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
    .fold-out {
      animation: foldOut 1.0s ease forwards;
    }

    @keyframes foldOut {
      0% {
        opacity: 1;
        transform: scaleY(1);
      }

      80% {
        opacity: 0.3;
        transform: scaleY(0.2);
      }

      100% {
        opacity: 0;
        transform: scaleY(0);
        height: 0;
      }
    }

    input {
      width: 80%;
      padding: 10px;
      margin: 8px 0;
      border: none;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.15);
      color: #fff;
      font-size: clamp(18px, 2.8vw, 21px);
      /* âœ… ë°˜ì‘í˜• ê¸€ì í¬ê¸° */
    }

    input::placeholder {
      color: #ccc;
    }

    button {
      background: #4f9cff;
      border: none;
      color: #fff;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
      transition: background 0.3s;
    }

    button:hover {
      background: #367de3;
    }

    .divider {
      margin: 25px 0;
      border-top: 1px solid rgba(255, 255, 255, 0.2);
    }

    .message {
      font-size: 14px;
      color: #ffcccb;
      margin-top: 6px;
    }

    /* âœ… ê·¸ë£¹ ëª©ë¡ */
    #groupSection {
      display: none;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.6s ease;
      margin-top: 20px;
      text-align: center;
    }

    #groupSection.active {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    .group-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 14px;
      justify-content: center;
      margin-bottom: 24px;
    }

    .group-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 12px;
      padding: 16px 8px;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s ease;
      font-size: clamp(17px, 2.5vw, 20px);
      /* âœ… ë°˜ì‘í˜• ê¸€ì í¬ê¸° */
    }

    .group-btn:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: translateY(-2px);
    }

    .add-btn {
      background: #007bff;
      border-radius: 8px;
      padding: 12px 18px;
      color: white;
      cursor: pointer;
      border: none;
      font-weight: 600;
      transition: background 0.25s;
      font-size: clamp(18px, 2.8vw, 21px);
      /* âœ… ë°˜ì‘í˜• ê¸€ì í¬ê¸° */
    }

    .add-btn:hover {
      background: #339dff;
    }

    #logoutBtn:hover {
      background: #ff5252;
    }

    /* âœ… ìƒë‹¨ ì¸ì‚¬ë°” - í”Œë¡œíŒ… ì œê±° & ìˆ˜í‰ ì •ë ¬ */
    #welcomeBar {
      display: flex;
      justify-content: flex-end;
      /* ì˜¤ë¥¸ìª½ ì •ë ¬ */
      align-items: center;
      gap: 10px;
      position: relative;
      /* í”Œë¡œíŒ… ì œê±° */
      margin-bottom: 10px;
      width: 100%;
    }

    #welcomeMsg {
      color: #ffdf6b;
      font-size: 16px;
      font-weight: 500;
      display: none;
      /* ê¸°ë³¸ì€ ìˆ¨ê¹€ */
    }

    /* âœ… ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ */
    #logoutBtn {
      background: #ff6b6b;
      border: none;
      color: #fff;
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
      display: none;
      font-size: 12px;
      position: static;
      /* âœ… í”Œë¡œíŒ… ì œê±° */
    }

    #logoutBtn:hover {
      background: #ff5252;
    }

    /* âœ… í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
    #toast {
      visibility: hidden;
      min-width: 240px;
      background: rgba(0, 0, 0, 0.85);
      color: #fff;
      text-align: center;
      border-radius: 10px;
      padding: 16px 24px;
      position: fixed;
      left: 50%;
      top: 50%;
      /* âœ… ê°€ìš´ë° ì •ë ¬ */
      transform: translate(-50%, -50%);
      /* âœ… ê°€ë¡œì„¸ë¡œ ëª¨ë‘ ì¤‘ì•™ */
      font-size: 17px;
      z-index: 2000;
      opacity: 0;
      transition: opacity 0.4s ease;
      pointer-events: none;
    }

    #toast.show {
      visibility: visible;
      opacity: 1;
    }

    /* âœ… ìë™ ë¡œê·¸ì¸ ë¡œë”© ì˜¤ë²„ë ˆì´ */
    #loadingOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.75);
      color: #ffdf6b;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9998;
      font-size: 18px;
    }

    #loadingOverlay .loader {
      border: 3px solid rgba(255, 255, 255, 0.2);
      border-top: 3px solid #ffdf6b;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      animation: spin 1s linear infinite;
      margin-bottom: 12px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .share-btn {
      background: #8b5cf6;
      border: none;
      border-radius: 8px;
      color: white;
      padding: 12px 18px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.25s;
      font-size: clamp(17px, 2.8vw, 20px);
    }

    .share-btn:hover {
      background: #a78bfa;
    }

    /* âœ… ìƒˆ ê·¸ë£¹ ì¶”ê°€ / ê³µìœ  ê·¸ë£¹ ì¶”ê°€ ê°„ê²© ì •ë ¬ */
    #groupSection {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
      /* ğŸ”¹ ìœ„ ê·¸ë£¹ ë²„íŠ¼(.group-grid)ê³¼ ë™ì¼ ê°„ê²© */
    }

    #groupSection .add-btn,
    #groupSection .share-btn {
      margin: 0;
      /* ê¸°ì¡´ ì—¬ë°± ì œê±° */
    }

    /* âœ… ë‚´ ê·¸ë£¹ ê´€ë¦¬ ì œëª© + ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ê· ë“± ë°°ì¹˜ */
    .title-bar {
      display: flex;
      justify-content: space-between;
      /* ì¢Œìš° ê· ë“± */
      align-items: center;
      margin-bottom: 20px;
    }

    .title-bar h2 {
      color: #ffdf6b;
      margin: 0;
      font-size: 22px;
    }

    .title-bar #logoutBtn {
      background: transparent;
      /* ğŸ”¸ë°°ê²½ ì œê±° */
      color: #d18fff;
      /* ì‚´ì§ ë¶€ë“œëŸ¬ìš´ ë¶‰ì€ìƒ‰ í…ìŠ¤íŠ¸ */
      /* border: 1px solid #ff7b7b80;           íë¦° ë¶‰ì€ í…Œë‘ë¦¬ */
      padding: 6px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.25s ease;
    }

    .title-bar #logoutBtn:hover {
      background: rgba(255, 107, 107, 0.1);
      /* ğŸ”¸hover ì‹œ ì€ì€í•œ ë¶‰ì€ ìŒì˜ */
      color: #ffdf6b;
      /* ë…¸ë€ìƒ‰ìœ¼ë¡œ ë°”ë€Œë©° ê°•ì¡° */
      border-color: #ffdf6b80;
    }

    .title-bar #logoutBtn:hover {
      background: #ff5252;
    }

    /* âœ… ìƒˆ ê·¸ë£¹ ì¶”ê°€ / ê³µìœ  ê·¸ë£¹ ì¶”ê°€ ë²„íŠ¼ ê°„ê²© í†µì¼ */
    #groupSection {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
      /* ê·¸ë£¹ ë²„íŠ¼(gap: 14px)ê³¼ ë™ì¼í•˜ê²Œ */
    }

    .bottom-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      /* ê·¸ë£¹ ë²„íŠ¼ê³¼ ë™ì¼í•œ ë„ˆë¹„ */
      gap: 14px;
      width: 100%;
      margin-top: 10px;
    }

    .bottom-buttons .add-btn,
    .bottom-buttons .share-btn {
      width: 100%;
      /* ê°€ë¡œí­ì„ ê·¸ë¦¬ë“œì— ë§ì¶° ëŠ˜ë¦¼ */
      height: 50px;
      /* ê·¸ë£¹ ë²„íŠ¼ ë†’ì´ì™€ ì¼ì¹˜ */
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(17px, 2.5vw, 20px);
    }

    /* âœ… 'ì „ì²´ ê¸°ë„ë¬¸ ë³´ê¸°' ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .view-all-wrapper {
      display: flex;
      justify-content: center;
      margin-top: 18px;
    }

    .view-all-btn {
      background: linear-gradient(90deg, #3b82f6, #8b5cf6);
      color: white;
      width: 100%;
      border: none;
      border-radius: 10px;
      padding: 10px 20px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
      transition: transform 0.15s, opacity 0.2s;
    }

    .view-all-btn:hover {
      transform: translateY(-2px);
      opacity: 0.9;
    }

    /* âœ… ê·¸ë£¹ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ë¡œë” */
    .mini-loader {
      border: 3px solid rgba(255, 255, 255, 0.2);
      border-top: 3px solid #ffdf6b;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
    }

    /* âœ… ìë™ ë¡œê·¸ì¸ ë¡œë”© ì˜¤ë²„ë ˆì´ */
    #loadingOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.75);
      color: #ffdf6b;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9998;
      font-size: 18px;
    }

    #loadingOverlay .loader {
      border: 3px solid rgba(255, 255, 255, 0.2);
      border-top: 3px solid #ffdf6b;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      animation: spin 1s linear infinite;
      margin-bottom: 12px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* â–£ ìƒˆ ê·¸ë£¹ ì¶”ê°€ í¼ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    .add-group-form {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(10, 12, 30, 0.95);
      padding: 20px;
      border-top-left-radius: 16px;
      border-top-right-radius: 16px;
      transform: translateY(100%);
      transition: transform 0.45s ease;
      z-index: 9999;
    }

    .add-group-form.show {
      transform: translateY(0%);
    }

    .form-box h2 {
      color: #ffd86b;
      text-align: center;
      margin-bottom: 10px;
    }

    .form-box label {
      color: #fff;
      font-size: 14px;
      display: block;
      margin-top: 12px;
      margin-bottom: 5px;
    }

    #newGroupName,
    .member-input {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      background: #1c2035;
      border: 1px solid #444a67;
      color: #fff;
      font-size: 15px;
    }

    .member-add-btn {
      margin-top: 12px;
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      background: #30395a;
      color: #fff;
      border: none;
    }

    .btn-row {
      display: flex;
      justify-content: space-between;
      margin-top: 15px;
    }

    .cancel-btn {
      width: 48%;
      padding: 12px;
      background: #666;
      color: #fff;
      border-radius: 10px;
      border: none;
    }

    .save-btn {
      width: 48%;
      padding: 12px;
      background: #4c8fff;
      color: #fff;
      border-radius: 10px;
      border: none;
    }

    .save-btn.disabled {
      opacity: 0.4;
    }

    .save-loading {
      text-align: center;
      margin-top: 10px;
      color: #ffd86b;
      font-size: 16px;
    }

    .loader {
      width: 22px;
      height: 22px;
      border: 3px solid rgba(255, 255, 255, 0.25);
      border-top-color: #ffd86b;
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      margin: 8px auto 0;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body>

  <div class="container" id="authContainer">
    <h2>ğŸ™ ê¸°ë„ê·¸ë£¹ ë¡œê·¸ì¸</h2>
    <div id="loginSection">
      <input type="text" id="loginId" placeholder="ì•„ì´ë””" minlength="4" required />
      <input type="password" id="loginPwd" placeholder="ë¹„ë°€ë²ˆí˜¸" minlength="4" required />
      <button onclick="login()">ë¡œê·¸ì¸</button>
      <p class="message" id="loginMsg"></p>
    </div>

    <div class="divider"></div>

    <h2>ğŸ•Š íšŒì›ê°€ì…</h2>
    <div id="signupSection">
      <input type="text" id="signupId" placeholder="ìƒˆ ì•„ì´ë””" minlength="4" required />
      <input type="password" id="signupPwd" placeholder="ë¹„ë°€ë²ˆí˜¸" minlength="4" required />
      <input type="password" id="signupPwd2" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" minlength="4" required />
      <input type="email" id="signupEmail" placeholder="ì´ë©”ì¼ì£¼ì†Œ (í•„ìˆ˜)" required />
      <button onclick="signup()">íšŒì›ê°€ì…</button>
      <p class="message" id="signupMsg"></p>
    </div>

    <div id="signupLoading" style="display:none; margin-top:10px; color:#ffd86b; font-size:16px;">
      íšŒì›ê°€ì… ì¤‘â€¦
      <div class="loader" style="
    border: 3px solid rgba(255,255,255,0.2);
    border-top: 3px solid #ffdf6b;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    animation: spin 1s linear infinite;
    margin: 10px auto 0;">
      </div>
    </div>

  </div>

  <!-- âœ… ê·¸ë£¹ ëª©ë¡ -->
  <div id="groupSection">
    <div class="title-bar">
      <h2>ğŸ“‹ ë‚´ ê·¸ë£¹ ê´€ë¦¬</h2>
      <button id="logoutBtn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>

    <div id="groupGrid" class="group-grid"></div>
    <div class="bottom-buttons">
      <button class="add-btn" onclick="showAddGroupForm()">â• ìƒˆ ê·¸ë£¹ ì¶”ê°€</button>
      <button class="add-btn" onclick="showSharedGroupForm()">ğŸ”— ê³µìœ  ê·¸ë£¹ ì¶”ê°€</button>
    </div>
  </div>

  <!-- âœ… ìƒˆ ë²„íŠ¼ ì¶”ê°€ -->
  <div class="view-all-wrapper" id="viewAllWrapper" style="display:none;">
    <button class="view-all-btn" onclick="location.href='view-all.html'">
      ğŸ“– ë‚´ ê·¸ë£¹ì˜ ì „ì²´ ê¸°ë„ë¬¸ ë³´ê¸°
    </button>
  </div>

  <!-- âœ… ìë™ ë¡œê·¸ì¸ ë¡œë”© ì˜¤ë²„ë ˆì´ -->
  <div id="loadingOverlay">
    <div class="loader"></div>
    <p>ğŸ”„ ìë™ ë¡œê·¸ì¸ ì¤‘ì…ë‹ˆë‹¤...</p>
  </div>

  <!-- ğŸ“Œ ê¸¸ê²Œ ëˆ„ë¥´ê¸° ë©”ë‰´ -->
  <div id="longPressMenu" style="display:none; position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
            background:#1e1e2f; padding:18px; border-radius:14px; 
            box-shadow:0 4px 20px rgba(0,0,0,0.4); z-index:3000; width:240px; text-align:center;">
    <h3 id="popupGroupName" style="margin:0 0 12px; color:#ffdf6b;"></h3>

    <button id="renameBtn" style="width:100%; padding:10px; margin-bottom:8px; background:#4f9cff;
                 border:none; border-radius:8px; color:white; cursor:pointer;">âœ ì´ë¦„ ìˆ˜ì •</button>
    <button id="deleteBtn" style="width:100%; padding:10px; margin-bottom:8px; background:#ff6b6b;
                 border:none; border-radius:8px; color:white; cursor:pointer;">ğŸ—‘ ì‚­ì œ</button>
    <button onclick="closeMenu()" style="width:100%; padding:10px; background:#555;
                 border:none; border-radius:8px; color:white; cursor:pointer;">âŒ ì·¨ì†Œ</button>
  </div>

  <!-- ğŸ“Œ ì´ë¦„ ìˆ˜ì • ì…ë ¥ì°½ -->
  <div id="renameBox" style="display:none; position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
            background:#1e1e2f; padding:18px; border-radius:14px; z-index:3001;
            width:260px; text-align:center;">
    <h3 style="margin:0 0 10px; color:#ffdf6b;">ì´ë¦„ ìˆ˜ì •</h3>
    <input id="renameInput" style="width:90%; padding:8px; border:none; border-radius:8px; 
                background:rgba(255,255,255,0.15); color:white;">
    <button id="renameConfirmBtn" style="width:100%; padding:10px; margin-top:10px; background:#3b82f6;
                 border:none; color:white; border-radius:8px; cursor:pointer;">ìˆ˜ì •í•˜ê¸°</button>
  </div>

  <!-- ğŸ“Œ ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ -->
  <div id="actionLoading" style="display:none; position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
            background:rgba(0,0,0,0.75); padding:20px; border-radius:12px; 
            color:#ffdf6b; font-size:18px; text-align:center;">
    <div class="loader" style="
    border:3px solid rgba(255,255,255,0.2);
    border-top:3px solid #ffdf6b;
    border-radius:50%;
    width:30px;height:30px;
    margin:auto;margin-bottom:10px;
    animation:spin 1s linear infinite;"></div>
    <div id="loadingText">ì²˜ë¦¬ ì¤‘â€¦</div>
  </div>

  <!-- â–£ ìƒˆ ê·¸ë£¹ ì¶”ê°€ í¼ (ì²˜ìŒì—ëŠ” ìˆ¨ê¹€) -->
  <div id="addGroupForm" class="add-group-form hidden">
    <div class="form-box">
      <h2>ìƒˆ ê·¸ë£¹ ì¶”ê°€</h2>

      <label>ê·¸ë£¹ëª…</label>
      <input type="text" id="newGroupName" placeholder="ê·¸ë£¹ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">

      <label>êµ¬ì„±ì›</label>
      <div id="memberList"></div>

      <button class="member-add-btn" onclick="addMemberField()">+ êµ¬ì„±ì› ì¶”ê°€</button>

      <div class="btn-row">
        <button class="cancel-btn" onclick="hideAddGroupForm()">ì·¨ì†Œ</button>
        <button id="saveGroupBtn" class="save-btn disabled" onclick="saveNewGroup()" disabled>ì €ì¥</button>
      </div>

      <div id="saveLoading" class="save-loading hidden">
        ì €ì¥ì¤‘â€¦
        <div class="loader"></div>
      </div>
    </div>
  </div>

  <!-- ğŸ“Œ ê³µìœ  ê·¸ë£¹ ì¶”ê°€ í¼ -->
  <div id="sharedGroupForm" class="add-group-form hidden">
    <div class="form-box">
      <h2>ğŸ”— ê³µìœ  ê·¸ë£¹ ì¶”ê°€</h2>

      <label>ê³µìœ  ë§í¬</label>
      <input type="text" id="sharedGroupLink" placeholder="ê·¸ë£¹ ë§í¬ë¥¼ ë¶™ì—¬ë„£ê¸° í•´ì£¼ì„¸ìš”">

      <div class="btn-row">
        <button class="cancel-btn" onclick="hideSharedGroupForm()">ì·¨ì†Œ</button>
        <button id="saveSharedBtn" class="save-btn disabled" onclick="saveSharedGroup()" disabled>ì €ì¥</button>
      </div>

      <div id="sharedSaveLoading" class="save-loading hidden">
        ì €ì¥ì¤‘â€¦
        <div class="loader"></div>
      </div>
    </div>
  </div>

  <style>
    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }
  </style>

  <script>

    const scriptURL = CONFIG.GAS_URL;

    /* ========================================================================= */
    /* ğŸ“Œ í•„ìˆ˜: ë²„íŠ¼ DOM ë¨¼ì € ê°€ì ¸ì˜¤ê¸° */
    /* ========================================================================= */
    const renameBtn = document.getElementById("renameBtn");
    const deleteBtn = document.getElementById("deleteBtn");
    const renameConfirmBtn = document.getElementById("renameConfirmBtn");
    const renameInput = document.getElementById("renameInput");

    /* ========================================================================= */
    /* ğŸ“Œ LOAD ì´ë²¤íŠ¸ (1ê°œë§Œ) */
    /* ========================================================================= */
    window.addEventListener("load", async () => {
      // â˜… ìë™ ë¡œê·¸ì¸ ì—¬ë¶€ ì²´í¬
      const savedId = localStorage.getItem("loginId");
      const savedPwd = localStorage.getItem("loginPwd");

      if (!savedId || !savedPwd) {
        showToast("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
      }

      const urlParams = new URLSearchParams(window.location.search);
      const fromRecord = urlParams.get("fromRecord");

      /* ------------------ ìë™ ë¡œê·¸ì¸ ì²˜ë¦¬ ------------------ */
      if (fromRecord === "1" && savedId) {
        showGroups(savedId);
        const viewAllWrapper = document.getElementById("viewAllWrapper");
        if (viewAllWrapper) viewAllWrapper.style.display = "flex";
      } else {
        if (savedId && savedPwd) {
          const overlay = document.getElementById("loadingOverlay");
          if (overlay) overlay.style.display = "flex";

          setTimeout(async () => {
            await autoLogin(savedId, savedPwd);
            if (overlay) overlay.style.display = "none";
          }, 300);
        }
      }


      /* ========================================================================= */
      /* ğŸ“Œ ê¸¸ê²Œëˆ„ë¥´ê¸° ë©”ë‰´ ë²„íŠ¼ ê¸°ëŠ¥ ì—°ê²° */
      /* ========================================================================= */
      if (renameBtn) {
        renameBtn.onclick = () => {
          closeMenu();
          renameInput.value = selectedGroupName;
          renameBox.style.display = "block";
        };
      }

      if (renameConfirmBtn) {
        renameConfirmBtn.onclick = async () => {
          const newName = renameInput.value.trim();
          if (!newName) return showToast("âš ï¸ ìƒˆ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.");

          showLoading("ì´ë¦„ ìˆ˜ì • ì¤‘â€¦");

          try {
            await fetch(scriptURL, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                mode: "renameGroup",
                groupId: selectedGroupId,
                newName
              })
            });

            closeRenameBox();
            showToast("âœ ì´ë¦„ ìˆ˜ì • ì™„ë£Œ!");
            await loadGroups(localStorage.getItem("adminId"));
          } finally {
            hideLoading();
          }
        };
      }

      if (deleteBtn) {
        deleteBtn.onclick = async () => {
          closeMenu();

          if (!confirm(`'${selectedGroupName}' ê·¸ë£¹ì„ ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œí›„ ë‹¤ì‹œ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) return;

          showLoading("ì‚­ì œ ì¤‘â€¦");

          try {
            await fetch(scriptURL, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                mode: "deleteGroup",
                groupId: selectedGroupId
              })
            });

            showToast("ğŸ—‘ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!");
            await loadGroups(localStorage.getItem("adminId"));
          } finally {
            hideLoading();
          }
        };
      }

    }); /* â† load ì´ë²¤íŠ¸ ë */


    /* ========================================================================= */
    /* ğŸ“Œ í† ìŠ¤íŠ¸ */
    function showToast(message, duration = 2500) {
      const toast = document.getElementById("toast");
      toast.textContent = message;
      toast.className = "show";
      setTimeout(() => {
        toast.className = toast.className.replace("show", "");
      }, duration);
    }

    /* ========================================================================= */
    /* ğŸ“Œ ìë™ ë¡œê·¸ì¸ */
    async function autoLogin(id, pwd) {
      try {
        const res = await fetch(`${scriptURL}?mode=login&id=${id}&pwd=${pwd}`);
        const data = await res.json();

        if (data.success) {
          showToast("âœ… ìë™ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.");
          const viewAllWrapper = document.getElementById("viewAllWrapper");
          if (viewAllWrapper) viewAllWrapper.style.display = "flex";
          showGroups(id);
        } else {
          const msg = document.getElementById("loginMsg");
          msg.style.color = "#ffcccb";
          msg.textContent = "âŒ ìë™ ë¡œê·¸ì¸ ì‹¤íŒ¨. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.";
        }
      } catch (err) {
        console.log("ìë™ ë¡œê·¸ì¸ ì‹¤íŒ¨:", err);
      }
    }

    /* ========================================================================= */
    /* ğŸ“Œ ë¡œê·¸ì¸ */
    async function login() {
      const id = loginId.value.trim();
      const pwd = loginPwd.value.trim();
      const msg = loginMsg;
      msg.textContent = "";

      if (id.length < 4 || pwd.length < 4) {
        msg.textContent = "âš ï¸ ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ëŠ” 4ìë¦¬ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.";
        return;
      }

      const overlay = document.getElementById("loadingOverlay");
      overlay.style.display = "flex";

      try {
        const res = await fetch(`${scriptURL}?mode=login&id=${id}&pwd=${pwd}`);
        const data = await res.json();

        if (data.success) {
          msg.style.color = "#9fff9f";
          msg.textContent = "âœ… ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.";

          localStorage.setItem("loginId", id);
          localStorage.setItem("loginPwd", pwd);
          localStorage.setItem("adminId", id);

          const gRes = await fetch(`${scriptURL}?mode=getGroups&adminId=${id}`);
          const gData = await gRes.json();

          if (gData.groups) {
            const ids = gData.groups.map(g => g.ê·¸ë£¹ID);
            localStorage.setItem("groupIds", JSON.stringify(ids));
          }

          const viewAllWrapper = document.getElementById("viewAllWrapper");
          if (viewAllWrapper) viewAllWrapper.style.display = "flex";

          authContainer.classList.add("fold-out");

          setTimeout(() => showGroups(id), 650);
        } else {
          msg.style.color = "#ffcccb";
          msg.textContent = "âŒ ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
        }
      } catch {
        msg.textContent = "ì„œë²„ ì—°ê²° ì˜¤ë¥˜";
      } finally {
        overlay.style.display = "none";
      }
    }

    /* ========================================================================= */
    /* ğŸ“Œ ê·¸ë£¹ ëª©ë¡ í‘œì‹œ */
    async function showGroups(adminId) {
      authContainer.style.display = "none";
      groupSection.style.display = "block";

      showToast(`ğŸ™ ${adminId}ë‹˜ ë°˜ê°‘ìŠµë‹ˆë‹¤!`);

      setTimeout(() => logoutBtn.style.display = "block", 500);
      setTimeout(() => groupSection.classList.add("active"), 50);

      await loadGroups(adminId);
    }

    /* ========================================================================= */
    /* ğŸ“Œ ê·¸ë£¹ ëª©ë¡ ë¡œë”© */
    async function loadGroups(adminId) {
      const grid = groupGrid;

      grid.innerHTML = `
    <div style="display:flex;flex-direction:column;align-items:center;gap:10px;color:#ffdf6b;">
      <div class="mini-loader"></div>
      <p style="margin:0;">ê·¸ë£¹ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>`;

      try {
        const url = `${scriptURL}?mode=getGroups&adminId=${encodeURIComponent(adminId)}`;
        const res = await fetch(url);
        const data = await res.json();

        grid.innerHTML = "";

        if (!data.groups || data.groups.length === 0) {
          grid.innerHTML = "<p>ì•„ì§ ë“±ë¡ëœ ê·¸ë£¹ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
          return;
        }

        data.groups.forEach(g => {
          const btn = document.createElement("button");
          btn.className = "group-btn";
          btn.textContent = g.ê·¸ë£¹ëª…;

          btn.onclick = () => openGroup(g.ê·¸ë£¹ID);
          attachLongPress(btn, g.ê·¸ë£¹ID, g.ê·¸ë£¹ëª…);

          grid.appendChild(btn);
        });

      } catch (err) {
        grid.innerHTML = `<p style="color:#ff7b7b;">âš ï¸ ê·¸ë£¹ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>`;
      }
    }

    /* ========================================================================= */
    /* ğŸ“Œ ê·¸ë£¹ ì—´ê¸° */
    function openGroup(groupId) {
      // ğŸ”¥ ì¦‰ì‹œ ë¡œë”© ì˜¤ë²„ë ˆì´ í‘œì‹œ
      const overlay = document.getElementById("loadingOverlay");
      const overlayText = overlay.querySelector("p");

      if (overlay) {
        overlayText.textContent = "ğŸš€ ê·¸ë£¹ìœ¼ë¡œ ì´ë™ ì¤‘...";
        overlay.style.display = "flex";
      }

      // ğŸ”¥ ì•½ê°„ì˜ ì§€ì—° í›„ í˜ì´ì§€ ì´ë™ (UI ë Œë”ë§ ë³´ì¥)
      setTimeout(() => {
        location.href = `record.html?gid=${groupId}&from=index`;
      }, 50);
    }

    /* ========================================================================= */
    /* ğŸ“Œ ê¸¸ê²Œëˆ„ë¥´ê¸° */
    let pressTimer = null;
    let selectedGroupId = "";
    let selectedGroupName = "";
    let enterTime = Date.now();

    function attachLongPress(btn, groupId, groupName) {
      btn.addEventListener("touchstart", startPress);
      btn.addEventListener("mousedown", startPress);
      btn.addEventListener("touchend", cancelPress);
      btn.addEventListener("mouseup", cancelPress);
      btn.addEventListener("mouseleave", cancelPress);

      function startPress() {
        selectedGroupId = groupId;
        selectedGroupName = groupName;

        pressTimer = setTimeout(() => {
          document.getElementById("popupGroupName").innerText = selectedGroupName;
          document.getElementById("longPressMenu").style.display = "block";
        }, 600);
      }

      function cancelPress() {
        clearTimeout(pressTimer);
      }
    }

    function closeMenu() {
      longPressMenu.style.display = "none";
    }
    function closeRenameBox() {
      renameBox.style.display = "none";
    }

    /* ========================================================================= */
    /* ğŸ“Œ ë¡œë”©ë°•ìŠ¤ */
    function showLoading(text) {
      loadingText.textContent = text;
      actionLoading.style.display = "block";
    }
    function hideLoading() {
      actionLoading.style.display = "none";
    }
    /* â–£ ìƒˆ ê·¸ë£¹ ì¶”ê°€ UI ì—´ê¸° */
    function showAddGroupForm() {
      const form = document.getElementById("addGroupForm");
      form.classList.remove("hidden");
      setTimeout(() => form.classList.add("show"), 10);

      // ì´ˆê¸°í™”
      document.getElementById("newGroupName").value = "";
      document.getElementById("memberList").innerHTML = "";
      addMemberField(); // êµ¬ì„±ì›1 ìë™ í¬í•¨
      checkGroupFormValid();
    }

    /* â–£ ìˆ¨ê¸°ê¸° */
    function hideAddGroupForm() {
      const form = document.getElementById("addGroupForm");
      form.classList.remove("show");
      setTimeout(() => form.classList.add("hidden"), 400);
    }

    /* â–£ êµ¬ì„±ì› í•­ëª© ì¶”ê°€ */
    function addMemberField() {
      const container = document.getElementById("memberList");

      const div = document.createElement("div");
      div.innerHTML = `
    <input class="member-input" placeholder="êµ¬ì„±ì› ì´ë¦„ ì…ë ¥">
  `;
      container.appendChild(div);

      checkGroupFormValid();
    }

    /* â–£ í¼ ì…ë ¥ ì²´í¬: ì €ì¥ ë²„íŠ¼ í™œì„±í™” ì—¬ë¶€ */
    function checkGroupFormValid() {
      const name = document.getElementById("newGroupName").value.trim();
      const members = [...document.querySelectorAll(".member-input")]
        .map(i => i.value.trim())
        .filter(v => v !== "");

      const saveBtn = document.getElementById("saveGroupBtn");

      if (name && members.length > 0) {
        saveBtn.classList.remove("disabled");
        saveBtn.disabled = false;
      } else {
        saveBtn.classList.add("disabled");
        saveBtn.disabled = true;
      }
    }

    /* â–£ ìƒˆ ê·¸ë£¹ ì €ì¥ */
    async function saveNewGroup() {
      const groupName = document.getElementById("newGroupName").value.trim();
      const members = [...document.querySelectorAll(".member-input")]
        .map(i => i.value.trim())
        .filter(v => v !== "");

      const saveBtn = document.getElementById("saveGroupBtn");
      const loading = document.getElementById("saveLoading");

      // ë²„íŠ¼ ë¹„í™œì„± + ë¡œë”© í‘œì‹œ
      saveBtn.disabled = true;
      saveBtn.innerText = "ì €ì¥ì¤‘â€¦";
      loading.classList.remove("hidden");

      // â˜…â˜…â˜…â˜…â˜… ì—¬ê¸°ì— console.log ì¶”ê°€ â˜…â˜…â˜…â˜…â˜…
      const loginId = localStorage.getItem("adminId");
      console.log("â–¶ ìƒˆ ê·¸ë£¹ ì¶”ê°€ adminId:", loginId);

      const body = {
        mode: "addGroup",
        adminId: localStorage.getItem("adminId"),  // â˜… ê´€ë¦¬ìID ì¶”ê°€
        groupName,
        members
      };

      try {
        const res = await fetch(CONFIG.GAS_URL, {
          method: "POST",
          body: JSON.stringify(body),
          headers: { "Content-Type": "application/json" }
        });

        const json = await res.json();
        console.log(json);

        saveBtn.innerText = "ì €ì¥ë¨ âœ“";
        loading.classList.add("hidden");

        // 1ì´ˆ ë’¤ ë‹«ê¸° + í™”ë©´ ìƒˆë¡œê³ ì¹¨
        setTimeout(() => {
          hideAddGroupForm();
          location.href = "index.html?v=" + Date.now();
        }, 1000);


      } catch (err) {
        console.error(err);
        saveBtn.innerText = "ì˜¤ë¥˜!";
        loading.classList.add("hidden");
      }
    }

    /* ì…ë ¥ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ */
    document.addEventListener("input", (e) => {
      if (e.target.classList.contains("member-input") || e.target.id === "newGroupName") {
        checkGroupFormValid();
      }
    });

    function logout() {
      // ğŸ”¥ ì €ì¥ëœ ë¡œê·¸ì¸ ì •ë³´ ì‚­ì œ
      localStorage.removeItem("loginId");
      localStorage.removeItem("loginPwd");
      localStorage.removeItem("adminId");
      localStorage.removeItem("groupIds");

      showToast("ğŸ‘‹ ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");

      // ğŸ”¥ í™ˆ í™”ë©´ìœ¼ë¡œ ì´ë™
      setTimeout(() => {
        location.href = "index.html?v=" + Date.now();
      }, 800);
    }
    async function addSharedGroup() {
      const gid = new URLSearchParams(window.location.search).get("gid");
      const adminId = localStorage.getItem("loginId");

      if (!gid) {
        showToast("ê³µìœ ëœ ê·¸ë£¹ ë§í¬ê°€ ì•„ë‹™ë‹ˆë‹¤.");
        return;
      }

      if (!adminId) {
        showToast("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        return;
      }

      if (!confirm("ì´ ê³µìœ  ê·¸ë£¹ì„\në‚´ ê·¸ë£¹ìœ¼ë¡œ ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

      showToast("ì¶”ê°€ ì¤‘...");

      try {
        const res = await fetch(CONFIG.GAS_URL, {
          method: "POST",
          body: JSON.stringify({
            mode: "addSharedGroup",
            adminId,
            groupId: gid
          })
        });

        const data = await res.json();

        if (data.success) {
          showToast("ê³µìœ  ê·¸ë£¹ ë“±ë¡ ì™„ë£Œ!");
          loadGroups();
        } else {
          showToast(data.message || "ë“±ë¡ ì‹¤íŒ¨");
        }

      } catch (err) {
        showToast("ì„œë²„ ì˜¤ë¥˜");
        console.error(err);
      }
    }

    function showSharedGroupForm() {
      const form = document.getElementById("sharedGroupForm");
      form.classList.remove("hidden");
      setTimeout(() => form.classList.add("show"), 10);

      document.getElementById("sharedGroupLink").value = "";
      checkSharedGroupValid();
    }

    function hideSharedGroupForm() {
      const form = document.getElementById("sharedGroupForm");
      form.classList.remove("show");
      setTimeout(() => form.classList.add("hidden"), 400);
    }

    document.addEventListener("input", (e) => {
      if (e.target.id === "sharedGroupLink") {
        checkSharedGroupValid();
      }
    });

    function checkSharedGroupValid() {
      const link = document.getElementById("sharedGroupLink").value.trim();
      const btn = document.getElementById("saveSharedBtn");

      if (link) {
        btn.classList.remove("disabled");
        btn.disabled = false;
      } else {
        btn.classList.add("disabled");
        btn.disabled = true;
      }
    }

    async function saveSharedGroup() {
      const link = document.getElementById("sharedGroupLink").value.trim();
      const adminId = localStorage.getItem("loginId");

      const saveBtn = document.getElementById("saveSharedBtn");
      const loading = document.getElementById("sharedSaveLoading");

      // ë¹„í™œì„± + ë¡œë”©
      saveBtn.disabled = true;
      saveBtn.innerText = "ì €ì¥ì¤‘â€¦";
      loading.classList.remove("hidden");

      // ë§í¬ì—ì„œ gid ì¶”ì¶œ
      const gid = link.includes("gid=")
        ? link.split("gid=")[1].split("&")[0].trim()
        : link.trim();

      console.log("ê³µìœ  ê·¸ë£¹ ì¶”ê°€:", adminId, gid);

      try {
        const res = await fetch(CONFIG.GAS_URL, {
          method: "POST",
          body: JSON.stringify({
            mode: "addSharedGroup",
            adminId,
            groupId: gid
          })
        });

        const data = await res.json();
        console.log(data);

        if (data.success) {
          saveBtn.innerText = "ì €ì¥ë¨ âœ“";
        } else {
          saveBtn.innerText = "ì˜¤ë¥˜!";
        }

        loading.classList.add("hidden");

        // ë‹«ê³  ìƒˆë¡œê³ ì¹¨
        setTimeout(() => {
          hideSharedGroupForm();
          loadGroups(adminId);
        }, 1000);

      } catch (err) {
        console.error(err);
        saveBtn.innerText = "ì˜¤ë¥˜!";
        loading.classList.add("hidden");
      }
    }

    async function addVisitLog_Index() {
      try {
        const device = navigator.userAgent.includes("Mobile") ? "mobile" : "pc";
        const browser = navigator.userAgent;

        const adminId = localStorage.getItem("loginId") || "";

        await fetch(CONFIG.GAS_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            mode: "addLog",
            page: "index",
            adminId,
            groupId: "",
            member: "",
            from: "index",
            device,
            browser
          })
        });
      } catch (e) {
        console.warn("âŒ index ë¡œê·¸ ì‹¤íŒ¨:", e);
      }
    }

    window.addEventListener("beforeunload", async () => {
      const leaveTime = Date.now();
      const stayMs = leaveTime - enterTime;
      const staySec = Math.floor(stayMs / 1000);

      // ë°©ë¬¸ ë¡œê·¸ ì €ì¥
      await fetch(CONFIG.GAS_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          mode: "logStay",
          page: location.pathname.includes("record") ? "record" : "index",
          groupId: window.groupId || "",
          stay: staySec,
          time: new Date().toISOString()
        })
      });
    });

    function signup() {
      const id = document.getElementById("signupId").value.trim();
      const pwd = document.getElementById("signupPwd").value.trim();
      const pwd2 = document.getElementById("signupPwd2").value.trim();
      const email = document.getElementById("signupEmail").value.trim();
      const msg = document.getElementById("signupMsg");

      msg.textContent = "";
      msg.style.color = "white";

      // ğŸ”¥ ì—¬ê¸° ì¶”ê°€: ë¡œë”© ON
      document.getElementById("signupLoading").style.display = "block";

      const url = `${CONFIG.GAS_URL}?mode=signup&id=${id}&pwd=${pwd}&email=${email}`;

      fetch(url)
        .then(res => res.json())
        .then(data => {

          // ğŸ”¥ ì—¬ê¸° ì¶”ê°€: ë¡œë”© OFF
          document.getElementById("signupLoading").style.display = "none";

          if (data.success) {
            msg.style.color = "#90ff90";
            msg.textContent = "ğŸ‰ íšŒì›ê°€ì… ë˜ì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ì´ë™í•©ë‹ˆë‹¤...";

            localStorage.setItem("loginId", id);
            localStorage.setItem("loginPwd", pwd);
            localStorage.setItem("adminId", id);

            setTimeout(() => {
              showGroups(id);
            }, 800);
          } else {
            msg.style.color = "#ff8080";
            msg.textContent = "âŒ " + data.message;
          }
        })
        .catch(err => {
          // ğŸ”¥ ì—¬ê¸° ì¶”ê°€: ë¡œë”© OFF
          document.getElementById("signupLoading").style.display = "none";
          msg.style.color = "#ff8080";
          msg.textContent = "ì„œë²„ ì˜¤ë¥˜ ë°œìƒ";
        });
    }

    // í˜ì´ì§€ ë¡œë“œ í›„ ì‹¤í–‰
    document.addEventListener("DOMContentLoaded", addVisitLog_Index);

    if (navigator.serviceWorker && navigator.serviceWorker.controller) {
      navigator.serviceWorker.controller.postMessage({ type: "SKIP_WAITING" });
    }

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(reg => {
            console.log("SW ë“±ë¡ ì™„ë£Œ:", reg);

            // ìƒˆ ë²„ì „ ìë™ ì ìš©
            if (reg.waiting) {
              reg.waiting.postMessage({ type: 'SKIP_WAITING' });
            }

            reg.addEventListener('updatefound', () => {
              const newWorker = reg.installing;
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  newWorker.postMessage({ type: 'SKIP_WAITING' });
                }
              });
            });
          })
          .catch(err => console.error("SW ë“±ë¡ ì‹¤íŒ¨:", err));
      });
    }

  </script>
</body>
<!-- âœ… í† ìŠ¤íŠ¸ ë©”ì‹œì§€ -->
<div id="toast"></div>

</html>